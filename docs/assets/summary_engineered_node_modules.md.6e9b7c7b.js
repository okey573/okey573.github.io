import{_ as s,o as n,c as a,a as l}from"./app.a648a532.js";const D=JSON.parse('{"title":"node_modules","description":"","frontmatter":{"title":"node_modules"},"headers":[{"level":2,"title":"npm0","slug":"npm0","link":"#npm0","children":[]},{"level":2,"title":"npm1","slug":"npm1","link":"#npm1","children":[]},{"level":2,"title":"npm2","slug":"npm2","link":"#npm2","children":[]},{"level":2,"title":"npm3","slug":"npm3","link":"#npm3","children":[]},{"level":2,"title":"npm4","slug":"npm4","link":"#npm4","children":[]},{"level":2,"title":"npm5","slug":"npm5","link":"#npm5","children":[]},{"level":2,"title":"npm6","slug":"npm6","link":"#npm6","children":[]},{"level":2,"title":"npm7","slug":"npm7","link":"#npm7","children":[]},{"level":2,"title":"pnpm3","slug":"pnpm3","link":"#pnpm3","children":[]}],"relativePath":"summary/engineered/node_modules.md","lastUpdated":1693808812000}'),p={name:"summary/engineered/node_modules.md"},e=l(`<h1 id="node-modules" tabindex="-1">node_modules <a class="header-anchor" href="#node-modules" aria-hidden="true">#</a></h1><p>实操理解node_modules目录结构</p><p><em>环境（2022-8-16）：</em></p><p><code>node -v</code></p><blockquote><p>v16.15.1</p></blockquote><p><code>npm -v</code></p><blockquote><p>8.11.0</p></blockquote><p><code>yarn -v</code></p><blockquote><p>1.22.19</p></blockquote><p><code>pnpm -v</code></p><blockquote><p>7.9.0</p></blockquote><h2 id="npm0" tabindex="-1">npm0 <a class="header-anchor" href="#npm0" aria-hidden="true">#</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm0</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm0</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">element-plus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--save</span></span>
<span class="line"></span></code></pre></div><p>此时的目录结构：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.10.4</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- vue</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>解析： 这是因为在npm3之后采用了扁平结构，vue是element-plus的依赖，会提升到顶层，形成这样的目录结构，node_modules下其他的依赖也是如此。</p><p>此时在目录下再添加index.html文件，代码如下：</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">en</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Title</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">app</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">{{ message }}</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bundle.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>添加index.js文件 ，代码如下：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> vue </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> createApp </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> vue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">createApp</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">data</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Hello Vue!</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">mount</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>添加browserify依赖</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">browserify</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span></span>
<span class="line"></span></code></pre></div><p>在package.json中添加打包脚本</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">&quot;build&quot;: &quot;browserify index.js &gt; bundle.js&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>运行打包脚本后，然后打开html.index，可正常显示。</p><p>为什么项目依赖中里没有添加vue，但是却可以却是可以使用呢？这是因为node_modules的扁平结构，element-plus依赖了vue，所以可以项目中使用，这也就是所谓的幽灵依赖。</p><h2 id="npm1" tabindex="-1">npm1 <a class="header-anchor" href="#npm1" aria-hidden="true">#</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm1</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm1</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dayjs@1.11.2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--save</span></span>
<span class="line"></span></code></pre></div><p>此时的目录结构：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.11.2</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>此时的package.json ：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  &quot;dependencies&quot;: {</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;dayjs&quot;: &quot;^1.11.2&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>然后安装element-plus</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">element-plus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--save</span></span>
<span class="line"></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">安装完成后，新的目录结构</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus@2.2.13</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>解析： 可以在element-plus的package.json中看到，element-plus也依赖了dayjs</p><blockquote><p>&quot;dayjs&quot;: &quot;^1.11.3&quot;</p></blockquote><p>element-plus声明依赖dayjs的最低版本为1.11.3，项目中声明dayjs的最低版本为1.11.2，所以提升到当前的最新版本1.11.5</p><h2 id="npm2" tabindex="-1">npm2 <a class="header-anchor" href="#npm2" aria-hidden="true">#</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm2</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm2</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">element-plus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--save</span></span>
<span class="line"></span></code></pre></div><p>此时的目录结构：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>此时的package.json：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  &quot;dependencies&quot;: {</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;element-plus&quot;: &quot;^2.2.13&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>然后安装dayjs</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dayjs@1.11.2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--save</span></span>
<span class="line"></span></code></pre></div><p>安装完成后新的目录结构：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.11.2</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>新的package.json：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  &quot;dependencies&quot;: {</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;dayjs&quot;: &quot;^1.11.2&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;element-plus&quot;: &quot;^2.2.13&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>解析：就算当前项目中已通过间接依赖存在了dayjs，若再安装指定版本，还是会优先安装指定的版本。</p><p>若指定版本不满足其他包的版本要求，则会在对应包下再安装一份满足条件的版本；</p><p>若指定版本满足其他包的版本要求，则会统一使用新的依赖版本（下面是一个具体举例说明）；</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">//  若当时dayjs时指定版本为1.11.4</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">// npm install dayjs@1.11.4 --save</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">// 则生成的目录结构如下：</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.11.4</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="npm3" tabindex="-1">npm3 <a class="header-anchor" href="#npm3" aria-hidden="true">#</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm2</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm2</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">element-plus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--save</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ant-design-vue</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--save</span></span>
<span class="line"></span></code></pre></div><p>此时的目录结构：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ant-design-vue</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>然后安装dayjs</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.10.4</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ant-design-vue</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>可以看到 ant-design-vue和element-plus没有共享dayjs这个依赖</p><h2 id="npm4" tabindex="-1">npm4 <a class="header-anchor" href="#npm4" aria-hidden="true">#</a></h2><p>模拟从代码仓库clone代码：拷贝npm3下的package.json过来， 然后安装依赖</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span></span>
<span class="line"></span></code></pre></div><p>此时npm4的目录结构：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ant-design-vue</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>但是npm3的目录结构却不一样：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.10.4</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ant-design-vue</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>同样的代码，同样的脚本，但是生成的依赖不同，这是因为没有锁定版本。</p><h2 id="npm5" tabindex="-1">npm5 <a class="header-anchor" href="#npm5" aria-hidden="true">#</a></h2><p>和npm4做相同的事情，但是拷贝时，需要把package-lock.json一起拷贝过来</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span></span>
<span class="line"></span></code></pre></div><p>此时npm5的目录结构：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.10.4</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ant-design-vue</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>可以看到和npm3的结构是完全一样的：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.10.4</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ant-design-vue</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>上传package-lock.json这类lockFile是很有必要的，比如前段时间发布的vue2的最后一个版本vue2.7（代号Naruto）支持了Composition Api 这就是同一个大版本中的重大更新，lockFile可以有效避免团队间因本地代码依赖不同产生的问题。</p><h2 id="npm6" tabindex="-1">npm6 <a class="header-anchor" href="#npm6" aria-hidden="true">#</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm6</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm6</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">element-plus</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--save</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ant-design-vue</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--save</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dayjs@1.10.4</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--save</span></span>
<span class="line"></span></code></pre></div><p>此时的目录结构：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.10.4</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ant-design-vue</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>然后执行命令</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dedupe</span></span>
<span class="line"></span></code></pre></div><p>可以看到输出：</p><blockquote><p>removed 2 packages, changed 1 package, and audited 64 packages in 2s</p></blockquote><p>然后依赖的目录结构也发生了变化：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ant-design-vue</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>下面是官方对这个命令的解释</p><blockquote><p>Searches the local package tree and attempts to simplify the overall structure by moving dependencies further up the tree, where they can be more effectively shared by multiple dependent packages</p></blockquote><h2 id="npm7" tabindex="-1">npm7 <a class="header-anchor" href="#npm7" aria-hidden="true">#</a></h2><p>此时先断网，然后拷贝npm3下的package.json过来安装依赖</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span></span>
<span class="line"></span></code></pre></div><p>输出：</p><blockquote><p>added 63 packages in 45s</p></blockquote><p>npm采用了离线缓存，下面这个命令可以看到缓存列表</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cache</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ls</span></span>
<span class="line"></span></code></pre></div><h2 id="pnpm3" tabindex="-1">pnpm3 <a class="header-anchor" href="#pnpm3" aria-hidden="true">#</a></h2><p>拷贝npm3下的package.json过来， 然后安装依赖</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span></span>
<span class="line"></span></code></pre></div><p>会看到报错：</p><blockquote><p>Unmet peer dependencies Peer dependencies that should be installed: vue@&quot;&gt;=3.2.0 &lt;4.0.0&quot;</p></blockquote><p>此时需要添加vue依赖：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vue</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--save</span></span>
<span class="line"></span></code></pre></div><p>然后再install后成功，安装成功后的目录结构：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">+-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- .pnpm</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- ant-design-vue@3.2.11</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   +-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   |   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   |   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   +-- element-plus@2.2.13</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   +-- node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   |   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span style="color:#A6ACCD;">|   |   |   |   +-- ...</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- ant-design-vue</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- dayjs</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- element-plus</span></span>
<span class="line"><span style="color:#A6ACCD;">|   +-- vue</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- package.json</span></span>
<span class="line"><span style="color:#A6ACCD;">+-- pnpm-lock.yaml</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>在文件资源管理器里可以看到ant-design-vue, dayjs 这些重复依赖都是以符号链接的形式存在，而且依赖结构也没有扁平化。</p>`,106),o=[e];function c(t,i,C,r,y,A){return n(),a("div",null,o)}const u=s(p,[["render",c]]);export{D as __pageData,u as default};
