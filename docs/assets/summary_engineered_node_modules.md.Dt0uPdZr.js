import{_ as s,c as a,o as n,a4 as p}from"./chunks/framework.CbHUKvme.js";const u=JSON.parse('{"title":"node_modules","description":"","frontmatter":{"title":"node_modules"},"headers":[],"relativePath":"summary/engineered/node_modules.md","filePath":"summary/engineered/node_modules.md","lastUpdated":1720788835000}'),i={name:"summary/engineered/node_modules.md"},e=p(`<h1 id="node-modules" tabindex="-1">node_modules <a class="header-anchor" href="#node-modules" aria-label="Permalink to &quot;node_modules&quot;">​</a></h1><p>实操理解node_modules目录结构</p><p><em>环境（2022-8-16）：</em></p><p><code>node -v</code></p><blockquote><p>v16.15.1</p></blockquote><p><code>npm -v</code></p><blockquote><p>8.11.0</p></blockquote><p><code>yarn -v</code></p><blockquote><p>1.22.19</p></blockquote><p><code>pnpm -v</code></p><blockquote><p>7.9.0</p></blockquote><h2 id="npm0" tabindex="-1">npm0 <a class="header-anchor" href="#npm0" aria-label="Permalink to &quot;npm0&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> element-plus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --save</span></span></code></pre></div><p>此时的目录结构：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>|   +-- dayjs@1.10.4</span></span>
<span class="line"><span>|   +-- element-plus</span></span>
<span class="line"><span>|   +-- vue</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><p>解析： 这是因为在npm3之后采用了扁平结构，vue是element-plus的依赖，会提升到顶层，形成这样的目录结构，node_modules下其他的依赖也是如此。</p><p>此时在目录下再添加index.html文件，代码如下：</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;!</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">DOCTYPE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lang</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;en&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">meta</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> charset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UTF-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Title&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">head</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{{ message }}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bundle.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><p>添加index.js文件 ，代码如下：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> vue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;vue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">createApp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vue</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createApp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      message: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Hello Vue!&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;#app&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p>添加browserify依赖</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> browserify</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span></span></code></pre></div><p>在package.json中添加打包脚本</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>&quot;build&quot;: &quot;browserify index.js &gt; bundle.js&quot;</span></span></code></pre></div><p>运行打包脚本后，然后打开html.index，可正常显示。</p><p>为什么项目依赖中里没有添加vue，但是却可以却是可以使用呢？这是因为node_modules的扁平结构，element-plus依赖了vue，所以可以项目中使用，这也就是所谓的幽灵依赖。</p><h2 id="npm1" tabindex="-1">npm1 <a class="header-anchor" href="#npm1" aria-label="Permalink to &quot;npm1&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dayjs@1.11.2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --save</span></span></code></pre></div><p>此时的目录结构：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- dayjs@1.11.2</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><p>此时的package.json ：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;dependencies&quot;: {</span></span>
<span class="line"><span>    &quot;dayjs&quot;: &quot;^1.11.2&quot;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>然后安装element-plus</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> element-plus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --save</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>安装完成后，新的目录结构</span></span>
<span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>|   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- element-plus@2.2.13</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><p>解析： 可以在element-plus的package.json中看到，element-plus也依赖了dayjs</p><blockquote><p>&quot;dayjs&quot;: &quot;^1.11.3&quot;</p></blockquote><p>element-plus声明依赖dayjs的最低版本为1.11.3，项目中声明dayjs的最低版本为1.11.2，所以提升到当前的最新版本1.11.5</p><h2 id="npm2" tabindex="-1">npm2 <a class="header-anchor" href="#npm2" aria-label="Permalink to &quot;npm2&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm2</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> element-plus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --save</span></span></code></pre></div><p>此时的目录结构：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>|   +-- element-plus</span></span>
<span class="line"><span>|   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><p>此时的package.json：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;dependencies&quot;: {</span></span>
<span class="line"><span>    &quot;element-plus&quot;: &quot;^2.2.13&quot;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>然后安装dayjs</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dayjs@1.11.2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --save</span></span></code></pre></div><p>安装完成后新的目录结构：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>|   +-- dayjs@1.11.2</span></span>
<span class="line"><span>|   +-- element-plus</span></span>
<span class="line"><span>|   |   +-- node_modules</span></span>
<span class="line"><span>|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><p>新的package.json：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;dependencies&quot;: {</span></span>
<span class="line"><span>    &quot;dayjs&quot;: &quot;^1.11.2&quot;,</span></span>
<span class="line"><span>    &quot;element-plus&quot;: &quot;^2.2.13&quot;</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>解析：就算当前项目中已通过间接依赖存在了dayjs，若再安装指定版本，还是会优先安装指定的版本。</p><p>若指定版本不满足其他包的版本要求，则会在对应包下再安装一份满足条件的版本；</p><p>若指定版本满足其他包的版本要求，则会统一使用新的依赖版本（下面是一个具体举例说明）；</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>//  若当时dayjs时指定版本为1.11.4</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// npm install dayjs@1.11.4 --save</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// 则生成的目录结构如下：</span></span>
<span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>|   +-- dayjs@1.11.4</span></span>
<span class="line"><span>|   +-- element-plus</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><h2 id="npm3" tabindex="-1">npm3 <a class="header-anchor" href="#npm3" aria-label="Permalink to &quot;npm3&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm2</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> element-plus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --save</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ant-design-vue</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --save</span></span></code></pre></div><p>此时的目录结构：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>|   +-- ant-design-vue</span></span>
<span class="line"><span>|   +-- element-plus</span></span>
<span class="line"><span>|   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><p>然后安装dayjs</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>|   +-- dayjs@1.10.4</span></span>
<span class="line"><span>|   +-- ant-design-vue</span></span>
<span class="line"><span>|   |   +-- node_modules</span></span>
<span class="line"><span>|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- element-plus</span></span>
<span class="line"><span>|   |   +-- node_modules</span></span>
<span class="line"><span>|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><p>可以看到 ant-design-vue和element-plus没有共享dayjs这个依赖</p><h2 id="npm4" tabindex="-1">npm4 <a class="header-anchor" href="#npm4" aria-label="Permalink to &quot;npm4&quot;">​</a></h2><p>模拟从代码仓库clone代码：拷贝npm3下的package.json过来， 然后安装依赖</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre></div><p>此时npm4的目录结构：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>|   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- ant-design-vue</span></span>
<span class="line"><span>|   +-- element-plus</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><p>但是npm3的目录结构却不一样：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>|   +-- dayjs@1.10.4</span></span>
<span class="line"><span>|   +-- ant-design-vue</span></span>
<span class="line"><span>|   |   +-- node_modules</span></span>
<span class="line"><span>|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- element-plus</span></span>
<span class="line"><span>|   |   +-- node_modules</span></span>
<span class="line"><span>|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><p>同样的代码，同样的脚本，但是生成的依赖不同，这是因为没有锁定版本。</p><h2 id="npm5" tabindex="-1">npm5 <a class="header-anchor" href="#npm5" aria-label="Permalink to &quot;npm5&quot;">​</a></h2><p>和npm4做相同的事情，但是拷贝时，需要把package-lock.json一起拷贝过来</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre></div><p>此时npm5的目录结构：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>|   +-- dayjs@1.10.4</span></span>
<span class="line"><span>|   +-- ant-design-vue</span></span>
<span class="line"><span>|   |   +-- node_modules</span></span>
<span class="line"><span>|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- element-plus</span></span>
<span class="line"><span>|   |   +-- node_modules</span></span>
<span class="line"><span>|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><p>可以看到和npm3的结构是完全一样的：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>|   +-- dayjs@1.10.4</span></span>
<span class="line"><span>|   +-- ant-design-vue</span></span>
<span class="line"><span>|   |   +-- node_modules</span></span>
<span class="line"><span>|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- element-plus</span></span>
<span class="line"><span>|   |   +-- node_modules</span></span>
<span class="line"><span>|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><p>上传package-lock.json这类lockFile是很有必要的，比如前段时间发布的vue2的最后一个版本vue2.7（代号Naruto）支持了Composition Api 这就是同一个大版本中的重大更新，lockFile可以有效避免团队间因本地代码依赖不同产生的问题。</p><h2 id="npm6" tabindex="-1">npm6 <a class="header-anchor" href="#npm6" aria-label="Permalink to &quot;npm6&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm6</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm6</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> element-plus</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --save</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ant-design-vue</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --save</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dayjs@1.10.4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --save</span></span></code></pre></div><p>此时的目录结构：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>|   +-- dayjs@1.10.4</span></span>
<span class="line"><span>|   +-- ant-design-vue</span></span>
<span class="line"><span>|   |   +-- node_modules</span></span>
<span class="line"><span>|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- element-plus</span></span>
<span class="line"><span>|   |   +-- node_modules</span></span>
<span class="line"><span>|   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><p>然后执行命令</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dedupe</span></span></code></pre></div><p>可以看到输出：</p><blockquote><p>removed 2 packages, changed 1 package, and audited 64 packages in 2s</p></blockquote><p>然后依赖的目录结构也发生了变化：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>|   +-- ant-design-vue</span></span>
<span class="line"><span>|   +-- element-plus</span></span>
<span class="line"><span>|   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   +-- ...</span></span>
<span class="line"><span>+-- package.json</span></span></code></pre></div><p>下面是官方对这个命令的解释</p><blockquote><p>Searches the local package tree and attempts to simplify the overall structure by moving dependencies further up the tree, where they can be more effectively shared by multiple dependent packages</p></blockquote><h2 id="npm7" tabindex="-1">npm7 <a class="header-anchor" href="#npm7" aria-label="Permalink to &quot;npm7&quot;">​</a></h2><p>此时先断网，然后拷贝npm3下的package.json过来安装依赖</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre></div><p>输出：</p><blockquote><p>added 63 packages in 45s</p></blockquote><p>npm采用了离线缓存，下面这个命令可以看到缓存列表</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cache</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span></span></code></pre></div><h2 id="pnpm3" tabindex="-1">pnpm3 <a class="header-anchor" href="#pnpm3" aria-label="Permalink to &quot;pnpm3&quot;">​</a></h2><p>拷贝npm3下的package.json过来， 然后安装依赖</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre></div><p>会看到报错：</p><blockquote><p>Unmet peer dependencies Peer dependencies that should be installed: vue@&quot;&gt;=3.2.0 &lt;4.0.0&quot;</p></blockquote><p>此时需要添加vue依赖：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vue</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --save</span></span></code></pre></div><p>然后再install后成功，安装成功后的目录结构：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>+-- node_modules</span></span>
<span class="line"><span>|   +-- .pnpm</span></span>
<span class="line"><span>|   |   +-- ...</span></span>
<span class="line"><span>|   |   +-- ant-design-vue@3.2.11</span></span>
<span class="line"><span>|   |   |   +-- node_modules</span></span>
<span class="line"><span>|   |   |   |   +-- ...</span></span>
<span class="line"><span>|   |   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   |   |   |   +-- ...</span></span>
<span class="line"><span>|   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   |   +-- element-plus@2.2.13</span></span>
<span class="line"><span>|   |   |   +-- node_modules</span></span>
<span class="line"><span>|   |   |   |   +-- ...</span></span>
<span class="line"><span>|   |   |   |   +-- dayjs@1.11.5</span></span>
<span class="line"><span>|   |   |   |   +-- ...</span></span>
<span class="line"><span>|   +-- ant-design-vue</span></span>
<span class="line"><span>|   +-- dayjs</span></span>
<span class="line"><span>|   +-- element-plus</span></span>
<span class="line"><span>|   +-- vue</span></span>
<span class="line"><span>+-- package.json</span></span>
<span class="line"><span>+-- pnpm-lock.yaml</span></span></code></pre></div><p>在文件资源管理器里可以看到ant-design-vue, dayjs 这些重复依赖都是以符号链接的形式存在，而且依赖结构也没有扁平化。</p>`,106),l=[e];function t(h,d,k,c,o,g){return n(),a("div",null,l)}const y=s(i,[["render",t]]);export{u as __pageData,y as default};
